---

- name: Set authorized key for the vagrant user
  ansible.posix.authorized_key:
    user: vagrant
    state: present
    key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_ecdsa.pub') }}"

- name: Create the kube user account
  user: 
    name: kube 
    shell: /bin/bash

- name: Allow 'kube' to use sudo without needing a password
  lineinfile:
    dest: /etc/sudoers
    line: 'kube ALL=(ALL) NOPASSWD: ALL'
    validate: 'visudo -cf %s'

- name: Set authorized key for the kube user
  authorized_key:
    user: kube
    state: present
    key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_ecdsa.pub') }}"
